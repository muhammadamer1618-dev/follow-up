<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>استمارة متابعة معلم</title>

  <style>
    @page { size: A4; margin: 12mm; }

    body{font-family:Arial,sans-serif;background:#f4f8fc;margin:0;padding:12px;color:#000}
    .top{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:10px}
    .title{margin:0;color:#0d47a1;font-size:26px}
    .top-actions{display:flex;gap:8px;flex-wrap:wrap}
    .btn{border:0;border-radius:8px;padding:9px 14px;font-size:14px;cursor:pointer}
    .btn.back{background:#607d8b;color:#fff;text-decoration:none;display:inline-flex;align-items:center}
    .btn.print{background:#1976d2;color:#fff}
    .btn.clear{background:#e3f2fd;color:#0d47a1;border:1px solid #90caf9}

    .layout{display:flex;gap:12px;align-items:flex-start}
    .box{background:#fff;border:1px solid #bbdefb;border-radius:10px;padding:12px;box-sizing:border-box}
    .info{width:30%}
    .eval{width:70%}

    label{font-weight:bold;display:block;margin-top:8px}
    input,textarea{width:100%;padding:7px;margin-top:4px;border:1px solid #cfcfcf;border-radius:6px;box-sizing:border-box}
    textarea{height:64px}

    .tabs{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px}
    .tab{background:#e3f2fd;border:1px solid #90caf9;color:#0d47a1;border-radius:8px;padding:6px 12px;cursor:pointer;font-size:13px}
    .tab.active{background:#1976d2;color:#fff;border-color:#1976d2}

    .section{display:none}
    .section.active{display:block}

    .domain-title{margin:0 0 8px;color:#0d47a1;font-size:16px}

    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{border:1px solid #000;padding:6px;vertical-align:top}
    th{background:#e3f2fd;text-align:center}

    .col-score{width:70px;text-align:center;font-weight:bold}
    .col-eval{width:220px}
    .eval-grid{display:grid;grid-template-rows:auto auto auto;gap:6px;justify-items:center;margin-top:2px}
    .eval-opt{display:flex;align-items:center;gap:8px;justify-content:flex-start;width:100%}
    .eval-opt input{width:auto;margin:0}
    .eval-label{white-space:nowrap}

    .summary{margin-top:10px;background:#f6fbff;border:1px solid #bbdefb;border-radius:10px;padding:10px;display:flex;gap:14px;flex-wrap:wrap;align-items:center}
    .summary b{color:#0d47a1}
    .summary span{font-weight:bold}

    .notes{margin-top:10px}

    .sign-table{width:100%;border-collapse:collapse;margin-top:14px}
    .sign-table td{border:1px solid #000;padding:10px;text-align:center;font-weight:bold}
    .sign-line{height:60px}

    .print-all-note{margin-top:8px;font-size:12px;color:#1c1c1c;opacity:.85}

    @media print{
      body{background:#fff;padding:0}
      .top,.tabs,.btn{display:none !important}
      .layout{gap:8px}
      .section{display:block !important}
      .box{border:1px solid #000}
      .summary{border:1px solid #000}
      .page-break{page-break-before:always}
    }
  </style>
</head>

<body>
  <div class="top">
    <h1 class="title">استمارة متابعة معلم</h1>
    <div class="top-actions">
      <a class="btn back" href="index.html">الرجوع للرئيسية</a>
      <button class="btn print" id="printTwoPages">طباعة (صفحتين)</button>
      <button class="btn clear" id="clearForm">مسح الاختيارات</button>
    </div>
  </div>

  <div class="layout">
    <div class="box info">
      <label>اسم المعلم</label>
      <input id="teacherName">

      <label>المادة</label>
      <input id="subject">

      <label>الصف</label>
      <input id="grade">

      <label>التاريخ</label>
      <input type="date" id="visitDate">

      <label>رقم الزيارة</label>
      <input type="number" id="visitNumber">

      <label>اسم المشرف</label>
      <input id="supervisorName">
    </div>

    <div class="box eval">
      <div class="tabs" id="tabs"></div>

      <div id="sections"></div>

      <div class="summary">
        <div><b>المجموع:</b> <span id="rawTotal">0</span> / <span id="rawMax">0</span></div>
        <div><b>النسبة:</b> <span id="percentage">0%</span></div>
        <div><b>الدرجة النهائية:</b> <span id="finalScore">0</span> / 100</div>
      </div>

      <div class="notes">
        <label>إيجابيات الحصة</label>
        <textarea id="positives"></textarea>

        <label>التوصيات والتوجيهات</label>
        <textarea id="recommendations"></textarea>

        <table class="sign-table">
          <tr>
            <td>اسم المعلم</td>
            <td>اسم المشرف</td>
          </tr>
          <tr>
            <td class="sign-line"></td>
            <td class="sign-line"></td>
          </tr>
        </table>

        <div class="print-all-note">ملاحظة: في الطباعة تظهر كل المجالات كاملة حتى لو كنت تفتح مجال واحد فقط.</div>
      </div>
    </div>
  </div>

<script>
  const rubric = [
    {
      id: "vision",
      title: "الرؤية",
      items: [
        { label: "القيمة التربوية", best: "مناسب", mid: "إلى حد ما", worst: "غير مناسب" }
      ]
    },
    {
      id: "planning",
      title: "التخطيط للدرس",
      items: [
        { label: "التحضير المسبق للدرس", best: "مكتمل", mid: "غير مكتمل", worst: "غير موجود" },
        { label: "خطة الدرس", best: "مكتملة ومفصلة", mid: "غير مكتملة", worst: "غير موجودة" },
        { label: "أهداف الدرس", best: "واضحة قابلة للقياس", mid: "أهداف عامة", worst: "غير موجودة" },
        { label: "المفاهيم والمصطلحات العلمية", best: "محددة وواضحة في الخطة", mid: "غير محددة بدقة", worst: "غير موجودة" },
        { label: "تسلسل خطوات الدرس", best: "متسلسلة ومصممة جيدا", mid: "بعض الخطوات", worst: "خطوات قليلة" },
        { label: "إعدادات الفروق الفردية", best: "موجود بقوة", mid: "بعض الشواهد", worst: "لا توجد شواهد" }
      ]
    },
    {
      id: "management",
      title: "إدارة الصف",
      items: [
        { label: "تنظيم المقاعد", best: "مجموعات", mid: "خطوط", worst: "مزعج" },
        { label: "نظافة الفصل", best: "اهتمام عال بالنظافة", mid: "اهتمام مناسب", worst: "لا يوجد اهتمام" },
        { label: "البيئة الصفية", best: "معززة وإيجابية", mid: "مناسبة", worst: "غير مناسبة" },
        { label: "تنظيم إجابات الطلاب", best: "منظم", mid: "إلى حد ما", worst: "غير منظم" },
        { label: "الإدارة الصفية", best: "جيدة وفعالة", mid: "متوسطة", worst: "ضعيفة" },
        { label: "تفعيل القوانين الصفية", best: "مفعلة وفعالة", mid: "مفعلة وغير مفعلة", worst: "لا مفعلة" }
      ]
    },
    {
      id: "behavior",
      title: "دعم السلوك",
      items: [
        { label: "توجيهات المعلم", best: "واضحة وإجرائية", mid: "مبهمة", worst: "غير موجودة" },
        { label: "سلوك الطلاب", best: "ممتاز", mid: "مقبول", worst: "ضعيف" },
        { label: "تفاعل الطلاب", best: "ممتاز وقوي", mid: "إلى حد ما", worst: "ضعيف" },
        { label: "صور المعلم وإلهامه من الطلاب", best: "فعال عال المستوى", mid: "متوسط", worst: "محدود" }
      ]
    },
    {
      id: "strategies",
      title: "استراتيجيات التدريس",
      items: [
        { label: "خصائص الأسئلة حسب المنظومة", best: "مطابقة", mid: "إلى حد ما", worst: "غير مطابقة" },
        { label: "تنفيذ استراتيجيات التدريس", best: "ينفذ", mid: "إلى حد ما", worst: "لا ينفذ" },
        { label: "ممارسة التفكير", best: "ممارسة ممتازة", mid: "ممارسة متوسطة", worst: "ممارسة غير مناسبة" },
        { label: "أهداف الدرس", best: "معلنة وتناقش بداية الحصة", mid: "إما مدونة وإما تناقش", worst: "لا مدونة ولا تناقش" }
      ]
    },
    {
      id: "tools",
      title: "أدوات مساندة للتعلم",
      items: [
        { label: "الوسيلة التعليمية", best: "مستخدمة", mid: "محدودة", worst: "غير مستخدمة" },
        { label: "تفعيل السبورة التفاعلية", best: "مناسب جدا", mid: "محدود", worst: "لا يوجد تفعيل" },
        { label: "تطبيق ما تم التدريب عليه", best: "مستوى عال", mid: "مستوى مناسب", worst: "مستوى ضعيف" }
      ]
    },
    {
      id: "final",
      title: "التقويم الختامي",
      items: [
        { label: "ملخص الدرس", best: "خلاصة جيدة وواضحة", mid: "خلاصة محدودة", worst: "لا توجد خلاصة" }
      ]
    }
  ];

  const tabsEl = document.getElementById("tabs");
  const sectionsEl = document.getElementById("sections");

  let qCounter = 0;
  const questionMeta = [];

  function makeTab(domain, isActive){
    const b = document.createElement("button");
    b.className = "tab" + (isActive ? " active" : "");
    b.type = "button";
    b.textContent = domain.title;
    b.addEventListener("click", () => {
      document.querySelectorAll(".tab").forEach(x => x.classList.remove("active"));
      b.classList.add("active");
      document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
      document.getElementById("sec_" + domain.id).classList.add("active");
    });
    return b;
  }

  function makeSection(domain, isActive){
    const wrap = document.createElement("div");
    wrap.className = "section" + (isActive ? " active" : "");
    wrap.id = "sec_" + domain.id;

    const h = document.createElement("h3");
    h.className = "domain-title";
    h.textContent = domain.title;
    wrap.appendChild(h);

    const table = document.createElement("table");
    const thead = document.createElement("thead");
    thead.innerHTML = `
      <tr>
        <th class="col-score">الدرجة</th>
        <th class="col-eval">التقييم</th>
        <th>العنصر</th>
      </tr>
    `;
    table.appendChild(thead);

    const tbody = document.createElement("tbody");

    domain.items.forEach(item => {
      qCounter += 1;
      const qName = "q" + qCounter;
      const scoreId = "score_" + qName;

      questionMeta.push({ name: qName, scoreId });

      const tr = document.createElement("tr");

      const tdScore = document.createElement("td");
      tdScore.className = "col-score";
      tdScore.id = scoreId;
      tdScore.textContent = "0";

      const tdEval = document.createElement("td");
      tdEval.className = "col-eval";

      const grid = document.createElement("div");
      grid.className = "eval-grid";

      const optBest = document.createElement("label");
      optBest.className = "eval-opt";
      optBest.innerHTML = `<input type="radio" name="${qName}" value="4"><span class="eval-label">${item.best}</span>`;

      const optMid = document.createElement("label");
      optMid.className = "eval-opt";
      optMid.innerHTML = `<input type="radio" name="${qName}" value="3"><span class="eval-label">${item.mid}</span>`;

      const optWorst = document.createElement("label");
      optWorst.className = "eval-opt";
      optWorst.innerHTML = `<input type="radio" name="${qName}" value="1"><span class="eval-label">${item.worst}</span>`;

      grid.appendChild(optBest);
      grid.appendChild(optMid);
      grid.appendChild(optWorst);

      tdEval.appendChild(grid);

      const tdItem = document.createElement("td");
      tdItem.textContent = item.label;

      tr.appendChild(tdScore);
      tr.appendChild(tdEval);
      tr.appendChild(tdItem);

      tbody.appendChild(tr);
    });

    table.appendChild(tbody);
    wrap.appendChild(table);
    return wrap;
  }

  rubric.forEach((d, idx) => {
    tabsEl.appendChild(makeTab(d, idx === 0));
    sectionsEl.appendChild(makeSection(d, idx === 0));
  });

  const rawTotalEl = document.getElementById("rawTotal");
  const rawMaxEl = document.getElementById("rawMax");
  const percentageEl = document.getElementById("percentage");
  const finalScoreEl = document.getElementById("finalScore");

  function calcAll(){
    let raw = 0;
    questionMeta.forEach(q => {
      const sel = document.querySelector(`input[name="${q.name}"]:checked`);
      const val = sel ? Number(sel.value) : 0;
      raw += val;
      document.getElementById(q.scoreId).textContent = String(val);
    });

    const rawMax = questionMeta.length * 4;
    rawMaxEl.textContent = String(rawMax);
    rawTotalEl.textContent = String(raw);

    const finalScore = rawMax === 0 ? 0 : Math.round((raw / rawMax) * 100);
    finalScoreEl.textContent = String(finalScore);
    percentageEl.textContent = String(finalScore) + "%";
  }

  document.addEventListener("change", (e) => {
    if (e.target && e.target.matches('input[type="radio"]')) calcAll();
  });

  calcAll();

  document.getElementById("clearForm").addEventListener("click", () => {
    document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false);
    document.getElementById("positives").value = "";
    document.getElementById("recommendations").value = "";
    calcAll();
  });

  function buildSignTableHtml(){
    return `
      <table class="sign-table">
        <tr>
          <td>اسم المعلم</td>
          <td>اسم المشرف</td>
        </tr>
        <tr>
          <td class="sign-line"></td>
          <td class="sign-line"></td>
        </tr>
      </table>
    `;
  }

  function buildWrittenWorkTemplate(){
    let rows = "";
    for (let i = 0; i < 18; i += 1) {
      rows += `
        <tr>
          <td style="height:28px;"></td>
          <td></td>
          <td></td>
          <td></td>
        </tr>
      `;
    }

    return `
      <div class="page-break"></div>
      <h2 style="margin:0 0 10px;color:#0d47a1;text-align:center;">متابعة الأعمال التحريرية للطلاب</h2>
      <table style="width:100%;border-collapse:collapse;font-size:13px;">
        <tr>
          <th style="border:1px solid #000;background:#e3f2fd;padding:6px;">اسم الطالب</th>
          <th style="border:1px solid #000;background:#e3f2fd;padding:6px;">مصحح</th>
          <th style="border:1px solid #000;background:#e3f2fd;padding:6px;">غير مكتمل</th>
          <th style="border:1px solid #000;background:#e3f2fd;padding:6px;">غير مصحح</th>
        </tr>
        ${rows}
      </table>
      ${buildSignTableHtml()}
    `;
  }

  document.getElementById("printTwoPages").addEventListener("click", () => {
    document.querySelectorAll(".section").forEach(s => s.classList.add("active"));
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));

    const pageHtml = `
      <!DOCTYPE html>
      <html lang="ar" dir="rtl">
      <head>
        <meta charset="UTF-8">
        <title>طباعة التقرير</title>
        <style>
          @page { size: A4; margin: 12mm; }
          body{font-family:Arial,sans-serif;margin:0;color:#000}
          h1,h2{font-family:Arial,sans-serif}
          .box{border:1px solid #000;border-radius:8px;padding:10px;margin-bottom:10px}
          table{width:100%;border-collapse:collapse;font-size:13px}
          th,td{border:1px solid #000;padding:6px;vertical-align:top}
          th{background:#e3f2fd;text-align:center}
          .page-break{page-break-before:always}
          .sign-table{width:100%;border-collapse:collapse;margin-top:14px}
          .sign-table td{border:1px solid #000;padding:10px;text-align:center;font-weight:bold}
          .sign-line{height:60px}
          .summary{margin-top:10px;border:1px solid #000;border-radius:8px;padding:8px;font-weight:bold}
        </style>
      </head>
      <body>
        <h1 style="text-align:center;color:#0d47a1;margin:0 0 10px;">استمارة متابعة معلم</h1>

        <div class="box">
          <table>
            <tr>
              <th>اسم المعلم</th><td>${(document.getElementById("teacherName").value || "")}</td>
              <th>المادة</th><td>${(document.getElementById("subject").value || "")}</td>
            </tr>
            <tr>
              <th>الصف</th><td>${(document.getElementById("grade").value || "")}</td>
              <th>التاريخ</th><td>${(document.getElementById("visitDate").value || "")}</td>
            </tr>
            <tr>
              <th>رقم الزيارة</th><td>${(document.getElementById("visitNumber").value || "")}</td>
              <th>اسم المشرف</th><td>${(document.getElementById("supervisorName").value || "")}</td>
            </tr>
          </table>
        </div>

        ${[...document.querySelectorAll(".section")].map(sec => {
          const title = sec.querySelector(".domain-title") ? sec.querySelector(".domain-title").textContent : "";
          return `
            <div class="box">
              <h2 style="margin:0 0 8px;color:#0d47a1;font-size:16px;">${title}</h2>
              ${sec.querySelector("table").outerHTML}
            </div>
          `;
        }).join("")}

        <div class="summary">
          المجموع: ${document.getElementById("rawTotal").textContent} / ${document.getElementById("rawMax").textContent}
          &nbsp;&nbsp;|&nbsp;&nbsp; النسبة: ${document.getElementById("percentage").textContent}
          &nbsp;&nbsp;|&nbsp;&nbsp; الدرجة النهائية: ${document.getElementById("finalScore").textContent} / 100
        </div>

        <div class="box" style="margin-top:10px;">
          <div style="font-weight:bold;margin-bottom:6px;">إيجابيات الحصة</div>
          <div style="min-height:70px;border:1px solid #000;padding:8px;">${(document.getElementById("positives").value || "").replaceAll("\n","<br>")}</div>

          <div style="font-weight:bold;margin:10px 0 6px;">التوصيات والتوجيهات</div>
          <div style="min-height:70px;border:1px solid #000;padding:8px;">${(document.getElementById("recommendations").value || "").replaceAll("\n","<br>")}</div>

          ${buildSignTableHtml()}
        </div>

        ${buildWrittenWorkTemplate()}

        <script>window.onload=()=>{window.print();}</script>
      </body>
      </html>
    `;

    const w = window.open("", "_blank");
    w.document.open();
    w.document.write(pageHtml);
    w.document.close();
  });
</script>
</body>
</html>
